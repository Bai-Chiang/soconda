#%Module###<-magic cookie ####################################################
##
##   Simons Observatory Conda Environment.
##
##
# variables for Tcl script use only
set version  @VERSION@

module-whatis "Loads conda tools for the Simons Observatory."

proc ModulesHelp { } {
    global version
    puts stderr "\t\t Simons Observatory Conda Environment - Version $version\n"
    puts stderr ""
}

conflict sohpc so-env soconda python

# Dependency module commands
@MODLOAD@

if {[module-info command unload]} {
    system AUTO_ACTIVATE_BASE=false @BASE@/bin/conda deactivate
}

# This might be set by OS python and gives us problems.
unsetenv PYTHONSTARTUP

# Activate the conda environment by modifying the environment
# directly.  This is needed since the source-sh and system
# calls do not work.  This solution could be fragile, so should
# be revisited in the future.

setenv CONDA_EXE @BASE@/bin/conda
setenv CONDA_PYTHON_EXE "@BASE@/bin/python"
setenv CONDA_PREFIX "@ENVPREFIX@"
setenv CONDA_PROMPT_MODIFIER ""
setenv CONDA_SHLVL "1"
setenv CONDA_DEFAULT_ENV "@ENVNAME@"
prepend-path PATH "@ENVPREFIX@/bin"

# Create a versioned location for user-installed pip packages.
# Add this location to the start of the path.
set userbase $env(HOME)/.local/soconda/@VERSION@
setenv PYTHONUSERBASE $userbase
prepend-path PATH $userbase/bin
prepend-path PYTHONPATH $userbase/lib/python@PYVER@/site-packages
