--[[
    Conda Tools for the Simons Observatory
]]--

local name        = "soconda"
local version     = "@VERSION@"
local root        = "@ENVPREFIX@"

help([[
Simons Observatory Conda Environment - Version @VERSION@
]])

whatis("Name: " .. 'soconda')
whatis("Version: " .. "@VERSION@")
whatis("URL: " .. "https://github.com/simonsobs/soconda")
whatis("Description: " .. "Simons Observatory Conda Tools")

conflict("sohpc", "so-env", "soconda")

-- Dependency module commands
@MODLOAD@

-- This might be set by OS python and gives us problems.
unsetenv("PYTHONSTARTUP")

-- Activate the conda environment by modifying the environment
-- directly.  This is needed since the source-sh and system
-- calls do not work.  This solution could be fragile, so should
-- be revisited in the future.

setenv("CONDA_PREFIX", "@ENVPREFIX@")
setenv("CONDA_PROMPT_MODIFIER", "")
setenv("CONDA_SHLVL", "1")
setenv("CONDA_DEFAULT_ENV", "@ENVNAME@")
prepend_path("PATH", "@ENVPREFIX@/bin")

-- Create a versioned user directory for local pip installation
local userbase = pathJoin(HOME, ".local", "soconda", "@VERSION@")
setenv("PYTHONUSERBASE", userbase)
local userbin = pathJoin(userbase, "bin")
prepend_path("PATH", userbin)

